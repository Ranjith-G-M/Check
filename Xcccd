// Replace the login method in CustomerDAOImpl.java to include is_temp_password

@Override
public Customer login(String email, String password) throws Exception {
    Connection con = null;
    PreparedStatement ps = null;
    ResultSet rs = null;
    try {
        con = DbConnection.getConnection();
        
        // IMPORTANT: Added is_temp_password to SELECT
        String sql = "SELECT user_id, name, email, password, phone, dob, gender, address, city, state, zip, " +
                    "branch_name, id_proof_type, id_proof_number, account_type, pin, status, " +
                    "[intial_deposit_done], [is_temp_password] " +
                    "FROM [SQLTraining].[GMR_Bank].[ms_Users] WITH (NOLOCK) WHERE email=?";
        
        ps = con.prepareStatement(sql);
        ps.setString(1, email);
        rs = ps.executeQuery();
        
        if (rs.next()) {
            String storedHash = rs.getString("password");

            if (BCrypt.checkpw(password, storedHash)) {
                Customer u = new Customer();
                u.setUser_id(rs.getInt("user_id"));
                u.setName(rs.getString("name"));
                u.setEmail(rs.getString("email"));
                u.setPassword(storedHash);
                u.setPhone(rs.getString("phone"));
                u.setDob(rs.getDate("dob"));
                u.setGender(rs.getString("gender"));
                u.setAddress(rs.getString("address"));
                u.setCity(rs.getString("city"));
                u.setState(rs.getString("state"));
                u.setZip(rs.getString("zip"));
                u.setBranch_name(rs.getString("branch_name"));
                u.setId_proof_type(rs.getString("id_proof_type"));
                u.setId_proof_number(rs.getString("id_proof_number"));
                u.setAccount_type(rs.getString("account_type"));
                u.setIntial_deposit_done(rs.getBoolean("intial_deposit_done"));
                u.setPin(rs.getString("pin"));
                u.setStatus(rs.getString("status"));
                
                // IMPORTANT: Set the temp password flag
                u.setIs_temp_password(rs.getBoolean("is_temp_password"));

                logger.info("Login successful for: " + email + " (temp_password: " + u.isIs_temp_password() + ")");
                return u;
            } else {
                logger.info("Invalid password for user: " + email);
                return null;
            }
        } else {
            logger.info("No user found for email: " + email);
            return null;
        }

    } finally {
        if (rs != null) {
            rs.close();
        }
        if (ps != null) {
            ps.close();
        }
        if (con != null) {
            con.close();
        }
    }
}
