package com.library.model;

//	id, title, author, price, available count
//pojo
public class Book {
	private short id;
	private String title;
	private String author;
	private float price;
	private short availableCount;
	
	public short getId() {
		return id;
	}
	public void setId(short id) {
		this.id = id;
	}
	public String getTitle() {
		return title;
	}
	public void setTitle(String title) {
		this.title = title;
	}
	public String getAuthor() {
		return author;
	}
	public void setAuthor(String author) {
		this.author = author;
	}
	public double getPrice() {
		return price;
	}
	public void setPrice(short price) {
		this.price = price;
	}
	public short getAvailableCount() {
		return availableCount;
	}
	public void setAvailableCount(short availableCount) {
		this.availableCount = availableCount;
	}
	public void increaseCount() {
		availableCount++;
	}
	public void DecreaseCount() {
		if(availableCount>0) {
			availableCount--;
		}else {
			System.out.print("As of know there is no books available");
		}
	}
	public Book(short id,String title,String author,float price,short availableCount) {	
		this.id=id;
		this.title=title;
		this.author=author;
		this.price=price;
		this.availableCount=availableCount;	
	}
	
	@Override
	public String toString() {
		return "Book [id=" + id + ", title=" + title + ", author=" + author + ", price=" + price + ", availableCount="
				+ availableCount + "]";
	}
	
	

}

package com.library.member;

import java.time.LocalDate;
import java.time.temporal.ChronoUnit;
import java.util.ArrayList;
import java.util.List;
import com.library.borrow.Borrow;
import com.library.model.Book;

public abstract class Role {
	private int roleId;
	private String name;
	
	private List<Borrow> takenBooks;

	public Role(int roleId, String name) {
		this.roleId = roleId;
		this.name = name;
		this.takenBooks = new ArrayList<>();
	}
	
	public String getName() {
		return name;
	}
	
	public void borrowBook(Book book) {
		
		try {
			System.out.println("in role class");
		if(takenBooks.size()>=getMaxBooks()) {
			System.out.println("sorry "+name +"  you have reached maximum borrow limit");
		return;		
		}
		if(book.getAvailableCount()<=0) {
			System.out.println("Book not available");
			return;
		}
		takenBooks.add(new Borrow(book));
		
		System.out.println(takenBooks);
		
		book.DecreaseCount();
		System.out.println(name+"borrowed "+book.getTitle());
		
		}catch(Exception e) {
//			e.printStackTrace();
			System.out.println("in side the borrowbook in role class");
		}
	}
	
	public void returnBook(Book book) {
		Borrow record = null;
		for(Borrow b:takenBooks) {			
			Book book2 = b.getBook();
			short id = (short)book2.getId();
			
			if(id==book.getId()) {
				record =b;
				break;
			}
		}
		
		if(record == null) {
			System.out.println(name +" has not borrowed this book");
			return;
		}
		
		takenBooks.remove(record);
		book.increaseCount();
		
		Long diff =ChronoUnit.DAYS.between(record.getBorrowDate(), LocalDate.now());
		
		
		if(diff >5) {
			long fine =(diff-5)*getFinePerDay();
			System.out.println("book returning late fine is "+fine);
			
		}else {
			System.out.println("Book returning on time no fine");
		}
	}
		
	
	public abstract int getMaxBooks();
	public abstract int getFinePerDay();
}



package com.library.inheritedClasses;

import com.library.member.Role;

public class Student extends Role{
	
	public Student(int roleId,String name) {
		super(roleId,name);
	}

	@Override
	public int getMaxBooks() {
		return 5;
	}

	@Override
	public int getFinePerDay() {
		return 15;
	}
	
	

}

package com.library.inheritedClasses;

import com.library.member.Role;

public class Faculty extends Role{
	public Faculty(int roleId ,String name) {
		
		super(roleId,name);
	}

	@Override
	public int getMaxBooks() {
		return 10;
	}

	@Override
	public int getFinePerDay() {
		return 10;
	}

}


package com.library.borrow;

import java.time.LocalDate;
import java.util.Date;

import com.library.model.Book;

public class Borrow {
	
	private Book book;
	private LocalDate borrowDate;
	
	public Borrow(Book book) {
		this.book=book;
	}
	
	
	public void setBook(Book book) {
		this.book=book;
	}
	public void setBorrowDate(LocalDate borrowDate) {
		this.borrowDate=borrowDate;
	}
	public Book getBook() {
		return book;
	}
	public LocalDate getBorrowDate() {
		return borrowDate;
	}

}




package com.library.library;

import java.util.ArrayList;
import java.util.List;

import com.library.model.Book;

public class Library {
	
	private List<Book> book;
	
	public Library() {
		
		book= new ArrayList<>();
	}
	
	public void addBook(Book book) {
		this.book.add(book);
	}
	
	public boolean chekcId(int id) {
		
		for(Book b:book) {
			if(b.getId()==(short)id) {
				return true;
			}
		}
			
		return false;
	}
	
	public Book findBookByID(Short id) {
		
//		return book.stream()
//					.filter(b->b.getId() ==id)
//					.findFirst()
//					.orElse(null);
		
		for(Book b:book) {
			if(b.getId()==id) {
				return b;
			}
		}
		return null;
	}
	
	public void showBooks() {
//		for(Book b : book) {
//			System.out.println(b);
//		}or
//		book.stream()
//			.map(Book::toString)or
		
		book.forEach(System.out::println);
	}

}


package com.library.mainClass;

import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

import com.library.inheritedClasses.Faculty;
import com.library.inheritedClasses.Student;
import com.library.library.Library;
import com.library.member.Role;
import com.library.model.Book;

public class ExecutingClass {
	private static Scanner scan = new Scanner(System.in);
	static	Role student ;
	static	Role f ;
	static Library l = new Library();	
	private static List<Role> members = new ArrayList<>();

	public static void inBuiltStudents(Library l) {
//		members.add(new Student(101,"ravi"));
		student =new Student(101, "iron man");
		
		members.add(student);
	}
	public static void inBuiltFaculty(Library l) {
		members.add(new Faculty(201,"raghu"));
	}

	public static void inBuiltBook(Library l) {
		
		l.addBook(new Book((short)1,"Atomic Habits","james",150.0f ,(short)3));
		l.addBook(new Book((short)2,"Can't Hurt me","goggins",200.0f ,(short)5));
		l.addBook(new Book((short)3,"deep work","ranjith",100.0f ,(short)2));
		l.addBook(new Book((short)4,"pshcology of money","cane",350.0f ,(short)1));
		l.addBook(new Book((short)5,"secret","jack",150.0f ,(short)3));
		l.addBook(new Book((short)6,"distinory","rahul",50.0f ,(short)2));
	}
		
	public static void faculty() {
		boolean flag = true;
		while(flag) {
			System.out.println("Library Context");
			System.out.println();
			System.out.println("1. show books");
			System.out.println("2. book borrow");
			System.out.println("3. returning book");
			System.out.println("4. exit library");		
		
		System.out.println("Enter choice: ");
		
		int choice = scan.nextInt();
		
		switch(choice) {
		case 1:
			l.showBooks();
			break;
		case 2:
			System.out.println("Enter the Book id");
			f.borrowBook(l.findBookByID(scan.nextShort()));
			break;
		case 3:
			System.out.println("Enter the  book id");
			
			f.returnBook(l.findBookByID(scan.nextShort()));
			break;
		case 4:
			flag = false;
			break;
			
		default:
			System.out.print("Invalid Choice");
			break;
						
		}
		}
		scan.close();
		
	}
	
	public static void students() {		
		boolean flag = true;
		
		while(flag) {
			System.out.println("_____________________Library Context___________________");
			System.out.println();
			System.out.println("1. show books");
			System.out.println("2. book borrow");
			System.out.println("3. returning book");
			System.out.println("4. exit library\n");		
		
		System.out.println("[Enter choice:__ ");
		
		int choice = scan.nextInt();
		
		switch(choice) {
		case 1:
			l.showBooks();
			break;
		case 2:
			System.out.println("Enter the Book id");
			Short id=scan.nextShort();
			Book bookIdFounded = l.findBookByID(id);
			System.out.println(bookIdFounded);
				System.out.println("ghjk");
				student.borrowBook(bookIdFounded);
				
				System.out.println("fhuh");

//		student.borrowBook(l.findBookByID(scan.nextShort()));
			break;
		case 3:
			System.out.println("Enter the  book id");
			
			student.returnBook(l.findBookByID(scan.nextShort()));
			break;
		case 4:
			flag = false;
			break;
			
		default:
			System.out.print("Invalid Choice");
			break;
						
		}
		}
		scan.close();
		
	}
	
	public static void admin() {
		
		boolean flag = true;
		while(flag) {
			System.out.println("admin menu");
			System.out.println("1. add book");
			System.out.println("2. view books");
			System.out.println("3. add students");
			System.out.println("4. add faculty");
			System.out.println("5.back to main menu");
			
			
			int choice = scan.nextInt();
			scan.nextLine();
			
			switch(choice) {
			case 1:
				addBook();
				break;
			case 2:
				l.showBooks();
				break;
			case 3:
				addStudents();
				break;
			case 4:
				addFaculty();
				break;
			case 5:
				flag = false;
				admin();
				break;
			default:
				System.out.println("Invalid choice");
			}	
		}	
		
	}
	
	public static void addBook() {
		 System.out.println("enter book id");
		short id =scan.nextShort();
		
		if(l.chekcId(id)) {
			System.out.println("This id is already present \n");
			admin();
		}
		scan.nextLine();
		System.out.println("enter title");
		String title = scan.nextLine();
		System.out.println("enter author");
		String author =scan.nextLine();
		System.out.println("enter price");
		short price = scan.nextShort();
		System.out.println("enter availablity");
		
		short availability = scan.nextShort();
		
		if(availability <=0) {
			System.out.println("Please enter the valid book count \n");
			
			admin();
			return;
		}
		
		
		Book newBook = new Book(id,title,author,price,availability);
		l.addBook(newBook);
		System.out.println("book added");
		
	}
	
	public static void addStudents() {
		System.out.println(" enter students id:");
		int id = scan.nextInt();
		scan.nextLine();
		System.out.println("enter students name");
		String name = scan.nextLine();
		members.add(new Student(id,name));
		System.out.println("student added ");
		
	}
	public static void addFaculty() {
		System.out.println("enter Faculty id:");
		int id = scan.nextInt();
		System.out.println("enter Faculty name");
		String name = scan.nextLine();
		members.add(new Faculty(id,name));
		System.out.println("faculty added ");	
	}
	
	public static void main(String[] args) {
		
		System.out.println("----------------------------------------------------\n"
									+ "           ::Welcome to Ranjith Library::"
									+ "\n----------------------------------------------------");
		
		System.out.println("Please Specify your Role \n 1. Admin \n 2. student \n 3. faculty");
		
		System.out.println("Note: if you want to come back to previous menu please type 'Go Back'");
		
		
		inBuiltBook(l);
		inBuiltStudents(l);
		inBuiltFaculty(l);
		
		int role = scan.nextInt();
		
	
		try {
			switch(role) {
			
				case 1:
					admin();
					break;
				case 2:
					students();
					break;
				case 3:
					faculty();
					break;
				default:
					System.out.println("Invalid Options");
					break;
			  }
		}catch(Exception e) {
			System.out.print("error occured in main method ");
			e.printStackTrace();
		}

	
}
}





